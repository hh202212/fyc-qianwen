<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°äººæ”¶å…¥ç›®æ ‡æµ‹ç®—çœ‹æ¿</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #e60012; --gray: #f4f4f4; --border: #ddd; --gold: #d4a017; --tip-bg: #fffbe6; }
        body { font-family: "PingFang SC", "Microsoft YaHei"; background: #fafafa; margin: 0; padding: 12px; }
        * { box-sizing: border-box; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }

        .container { max-width: 1400px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 15px rgba(0,0,0,0.1); position: relative; }
        
        /* æ°´å°å±‚ */
        .watermark-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; opacity: 0.18; background-repeat: repeat; }

        .header-area { border-bottom: 2px solid var(--primary); margin-bottom: 10px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: flex-end; position: relative; z-index: 20; flex-wrap: wrap; gap: 10px; }
        .main-title { font-size: 22px; font-weight: bold; color: #333; margin: 0; }
        .sub-title { font-size: 13px; color: #999; }

        /* é¡¶éƒ¨æŒ‰é’®ç»„ */
        .top-nav-container { margin-bottom: 16px; display: flex; flex-wrap: wrap; gap: 8px; position: relative; z-index: 20; }
        .btn-link { color: #856404; background: var(--tip-bg); border: 1px solid #ffe58f; padding: 7px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center; transition: 0.2s; }
        .btn-link:hover { background: #fff1b8; border-color: #ffd666; transform: translateY(-1px); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .rule-btn::after { content: ' â–¼'; font-size: 10px; margin-left: 6px; }
        .rule-btn.active::after { content: ' â–²'; }
        
        .rule-body { display: none; background: var(--tip-bg); border: 1px solid #ffe58f; border-top: none; padding: 18px; border-radius: 0 0 4px 4px; margin-top: -8px; margin-bottom: 18px; position: relative; z-index: 19; }
        .rule-columns { display: flex; gap: 24px; flex-wrap: wrap; }
        .rule-col { flex: 1; min-width: 280px; font-size: 13px; color: #856404; line-height: 1.7; }

        /* è¾“å…¥é¢æ¿ï¼šç§»åŠ¨ç«¯å•åˆ— */
        .input-panel { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 16px; 
            background: var(--gray); 
            padding: 20px; 
            border-radius: 6px; 
            margin-bottom: 24px; 
            position: relative; 
            z-index: 20; 
            align-items: flex-end; 
        }
        @media (max-width: 768px) {
            .input-panel { flex-direction: column; align-items: stretch; }
            .input-group { width: 100%; }
        }
        .input-group { display: flex; flex-direction: column; gap: 8px; flex: 1; min-width: 160px; }
        .input-group label { font-size: 14px; font-weight: bold; color: #444; }
        input, select { height: 40px; padding: 0 10px; border: 1px solid var(--border); border-radius: 4px; background: #fff; font-size: 14px; width: 100%; outline: none; }

        .btn-calc { background: var(--primary); color: #fff; border: none; padding: 0 22px; border-radius: 4px; cursor: pointer; font-weight: bold; height: 40px; transition: 0.3s; }
        .btn-calc:hover { background: #c0000f; }

        .btn-action { color: #fff; border: none; padding: 9px 16px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 14px; }

        /* è¡¨æ ¼åŒº */
        .table-wrapper { 
            overflow-x: auto; 
            border: 1px solid var(--border); 
            border-radius: 4px; 
            position: relative; 
            z-index: 15; 
            background: #fff;
            margin-bottom: 10px;
            scrollbar-width: thin;
        }
        @media (min-width: 769px) {
            .table-wrapper::before {
                content: "â† å·¦å³æ»‘åŠ¨æŸ¥çœ‹å…¨éƒ¨æ–¹æ¡ˆ â†’";
                position: sticky;
                left: 0;
                background: #f9f9f9;
                color: #999;
                font-size: 12px;
                padding: 4px 8px;
                z-index: 4;
                pointer-events: none;
            }
        }

        .compare-table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 900px; }
        .compare-table th, .compare-table td { 
            border-right: 1px solid var(--border); 
            border-bottom: 1px solid var(--border); 
            padding: 12px 8px; 
            text-align: center; 
            font-size: 13px; 
            white-space: nowrap; 
        }
        .label-col { 
            width: 160px; 
            min-width: 160px !important; 
            background: #f9f9f9 !important; 
            text-align: left !important; 
            font-weight: bold; 
            position: -webkit-sticky; 
            position: sticky; 
            left: 0; 
            z-index: 5; 
            box-shadow: 2px 0 5px rgba(0,0,0,0.05); 
        }
        @media (max-width: 768px) {
            .label-col { position: static; box-shadow: none; }
        }
        .header-row th { 
            background: #fff; 
            position: sticky; 
            top: 0; 
            z-index: 6; 
            color: var(--primary); 
            border-bottom: 2px solid var(--primary); 
        }
        .cat-row { background: #fff1f0 !important; font-weight: bold; color: var(--primary); }
        .total-val { font-size: 18px; font-weight: 800; color: var(--primary); }
        .is-winner .total-val { color: var(--gold); }
        .crown-icon { display: none; font-size: 18px; margin-bottom: 3px; }
        .is-winner .crown-icon { display: block; }
        .del-btn { 
            display: block; 
            margin-top: 4px; 
            font-size: 11px; 
            color: #999; 
            cursor: pointer; 
            border: 1px solid #ddd; 
            padding: 1px 7px; 
            border-radius: 10px; 
            width: fit-content; 
            margin: 4px auto 0 auto; 
        }

        @media print {
            @page { size: A4 landscape; margin: 0.5cm; }
            .input-panel, .del-btn, .action-btns, .rule-toggle-container, .top-nav-container .btn-link:not(.rule-btn) { display: none !important; }
            .rule-body.print-active { display: block !important; border: 1px solid #ffe58f; margin-bottom: 15px; }
            .compare-table th, .compare-table td { padding: 6px 3px !important; font-size: 11px !important; }
            .label-col { position: static !important; }
        }
    </style>
</head>
<body>

<div class="container" id="mainContainer">
    <div class="watermark-overlay" id="watermark"></div>

    <div class="header-area">
        <div>
            <p class="main-title">æ–°äººæ”¶å…¥ç›®æ ‡æµ‹ç®—çœ‹æ¿</p>
            <p class="sub-title">ç‰ˆæƒå½’PAç¦å°æ˜Š - 2026ç‰ˆCç‰ˆæ ‡å‡†</p>
        </div>
        <div class="action-btns">
            <button class="btn-action" style="background:#52c41a;" onclick="exportExcel()">å¯¼å‡º Excel</button>
            <button class="btn-action" style="background:#1890ff;" onclick="smartPrint()">æ‰“å° A4</button>
        </div>
    </div>

    <div class="top-nav-container">
        <div class="btn-link rule-btn" id="ruleBtn" onclick="toggleRule()">è®­ç»ƒæ´¥è´´å‘æ”¾æ¡ä»¶</div>
        <a href="https://free-img.400040.xyz/4/2026/02/01/697f049d026fe.jpg" target="_blank" class="btn-link">é¦–æ¬¡é’»æ–¹æ¡ˆ â†—</a>
        <a href="https://www.pingan.cn" target="_blank" class="btn-link">æ–°äººå°é«˜å³°æ–¹æ¡ˆ â†—</a>
        <a href="https://www.pingan.cn" target="_blank" class="btn-link">ä¸»ç®¡é™ªè®¿æ–¹æ¡ˆ â†—</a>
        <a href="https://free-img.400040.xyz/4/2026/02/01/697f049ece8ab.jpg" target="_blank" class="btn-link">æ–°äººä¸€æ¡Œå®´æ–¹æ¡ˆ â†—</a>
    </div>

    <div class="rule-body" id="ruleBody">
        <div class="rule-columns">
            <div class="rule-col">
                <strong>ç¬¬ 1-12 æœŸè®­ç»ƒæ´¥è´´å‘æ”¾æ¡ä»¶</strong><br>
                1ï¼å½“æœˆå‚ä¼šç‡â‰¥75%ï¼›<br>
                2ï¼åŸ¹è®­è¾¾æ ‡ï¼šé£é¹°åŸ¹è®­(ç¬¬2æœˆ)ã€æ–°é”åŸ¹è®­(ç¬¬4æœˆ)ã€æ–°äººé›†è®­åˆæ ¼(ç¬¬5-12æœˆï¼Œä»…ä¼˜+/ä¼˜++)ï¼›<br>
                3ï¼æˆªè‡³å½“æœˆå·²è½¬æ­£ï¼ˆè‡ªå…¥å¸ç¬¬ 4 æœˆèµ·è€ƒå¯Ÿï¼‰
            </div>
            <div class="rule-col">
                <strong>ç¬¬ 13-18 æœŸè®­ç»ƒæ´¥è´´å‘æ”¾æ¡ä»¶</strong><br>
                ï¼ˆä¸€ï¼‰å½“æœˆå‚ä¼šç‡â‰¥75%ï¼›<br>
                ï¼ˆäºŒï¼‰æ–°å¥‘çº¦åœ¨èŒå•ç¬¬ 13 æœˆä¿è´¹ç»§ç»­ç‡â‰¥80%ã€‚
            </div>
        </div>
    </div>

    <div class="input-panel">
        <div class="input-group">
            <label>äººå‘˜èŒçº§</label>
            <select id="rank">
                <option value="P0" selected>P0 è¯•ç”¨ä¸šåŠ¡å‘˜</option>
                <option value="P1">P1 ä¸šåŠ¡å‘˜</option><option value="P2">P2 ä¸šåŠ¡å‘˜</option>
                <option value="P3">P3 ä¸šåŠ¡å‘˜</option><option value="P4">P4 ä¸šåŠ¡å‘˜</option>
                <option value="P5">P5 ä¸šåŠ¡å‘˜</option><option value="P6">P6 ä¸šåŠ¡å‘˜</option>
                <option value="P7">P7 ä¸šåŠ¡å‘˜</option><option value="P8">P8 ä¸šåŠ¡å‘˜</option>
                <option value="P9">P9 ä¸šåŠ¡å‘˜</option>
            </select>
        </div>
        <div class="input-group">
            <label>äººå‘˜æ ‡ç­¾</label>
            <select id="tag" onchange="initPeriodOptions()">
                <option value="ä¼˜++">ä¼˜++æ–°äºº</option><option value="ä¼˜+" selected>ä¼˜+æ–°äºº</option>
                <option value="FNA">FNAæ–°äºº</option><option value="NA">NAæ–°äºº</option>
            </select>
        </div>
        <div class="input-group"><label>è®­ç»ƒæ´¥è´´æœŸæ•°</label><select id="period"></select></div>
        <div class="input-group">
            <label>ä¸ªäººæœˆåº¦FYC (å…ƒ)</label>
            <input type="number" id="fyc" value="3000">
        </div>
        <div class="input-group">
            <label>æ˜¯å¦æœ‰å¢å‘˜ï¼Ÿ</label>
            <select id="hasReferral" onchange="updateReferralInputs()">
                <option value="å¦">å¦</option>
                <option value="æ˜¯">æ˜¯</option>
            </select>
        </div>
        <!-- å¢å‘˜è¾“å…¥å®¹å™¨ -->
        <div id="referralInputs" style="display: none;">
            <div class="input-group">
                <label>è¢«æ¨èæ–°äººå…¥å¸æœˆæ•°</label>
                <select id="referralMonths">
                    <option value="1-12">1-12 æœˆ</option>
                    <option value="13-24">13-24 æœˆ</option>
                </select>
            </div>
            <div class="input-group">
                <label>è¢«æ¨èæ–°äººå½“æœˆFYC (å…ƒ)</label>
                <input type="number" id="referralFycInput" value="2999" min="0">
            </div>
            <div class="input-group">
                <label>ç¬¬13ä¸ªæœˆä¿è´¹ç»§ç»­ç‡</label>
                <!-- é»˜è®¤å€¼è®¾ä¸º "80%ï¼ˆå«ï¼‰ä»¥ä¸Š" -->
                <select id="referralContinuation">
                    <option value="80%ä»¥ä¸‹">80% ä»¥ä¸‹</option>
                    <option value="80%ä»¥ä¸Š" selected>80%ï¼ˆå«ï¼‰ä»¥ä¸Š</option>
                </select>
            </div>
        </div>
        <button class="btn-calc" onclick="addScheme()">åŠ å…¥å¯¹æ¯”æ–¹æ¡ˆ</button>
    </div>

    <div class="table-wrapper">
        <table class="compare-table" id="resTable">
            <thead><tr class="header-row" id="hRow"><th class="label-col">å¯¹æ¯”ç»´åº¦</th></tr></thead>
            <tbody id="bBody">
                <tr class="cat-row"><td class="label-col">äººå‘˜ä¿¡æ¯</td></tr>
                <tr data-k="rank"><td class="label-col">æµ‹ç®—èŒçº§</td></tr>
                <tr data-k="tag"><td class="label-col">æ ‡ç­¾/æœŸæ•°</td></tr>
                <tr class="cat-row"><td class="label-col">ç›´æ¥æ”¶å…¥ç°é‡‘æµ</td></tr>
                <tr data-k="fyc"><td class="label-col">ä½£é‡‘ (FYC)</td></tr>
                <tr data-k="sales"><td class="label-col">é”€å”®æ´¥è´´ (ç³»æ•°C)</td></tr>
                <tr data-k="subsidy"><td class="label-col">è®­æ´¥ (å½“æœŸå®å‘)</td></tr>
                <tr class="cat-row"><td class="label-col">é€’å»¶è®°è´¦é¡¹</td></tr>
                <tr data-k="defer"><td class="label-col">è®­æ´¥é€’å»¶</td></tr>
                <!-- å¢å‘˜å¥–æ’å…¥åœ¨é€’å»¶ä¹‹å -->
                <tr data-k="ref_total"><td class="label-col">å¢å‘˜å¥–</td></tr>
                <tr class="total-row" data-k="total" style="background:#fff9f9"><td class="label-col">é¢„è®¡æ€»æ”¶ç›Š (å«é€’å»¶ä¸å¢å‘˜å¥–)</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    function toggleRule() {
        const body = document.getElementById('ruleBody');
        const btn = document.getElementById('ruleBtn');
        const isShow = body.style.display === 'block';
        body.style.display = isShow ? 'none' : 'block';
        body.classList.toggle('print-active', !isShow);
        btn.classList.toggle('active', !isShow);
    }

    const salesMatrix = {
        'P0':[0,0,0,0,0,0,0,0],'P1':[0,0,0,0,0,0,0,0],
        'P2':[0,0.04,0.09,0.13,0.13,0.13,0.13,0.13],
        'P3':[0,0.06,0.11,0.15,0.18,0.18,0.18,0.18],
        'P4':[0,0.06,0.25,0.30,0.35,0.35,0.35,0.35],
        'P5':[0,0.06,0.27,0.32,0.37,0.42,0.42,0.42],
        'P6':[0,0.06,0.30,0.34,0.40,0.45,0.47,0.47],
        'P7':[0,0.06,0.32,0.37,0.42,0.50,0.52,0.55],
        'P8':[0,0.06,0.32,0.37,0.45,0.52,0.55,0.57],
        'P9':[0,0.06,0.32,0.37,0.45,0.55,0.57,0.60]
    };

    function initPeriodOptions() {
        const t = document.getElementById('tag').value;
        const p = document.getElementById('period');
        p.innerHTML = '';
        let opts = t==='ä¼˜++' ? [['4-12æœŸ','4-12'],['13-18æœŸ','13-18']] : [['1-3æœŸ','1-3'],['4-12æœŸ','4-12'],['13-18æœŸ','13-18']];
        opts.forEach(o => p.add(new Option(o[0], o[1])));
    }

    function getSalesRate(fyc, rank) {
        const rates = salesMatrix[rank] || salesMatrix['P0'];
        if (fyc < 1500) return rates[0]; if (fyc < 3000) return rates[1];
        if (fyc < 6000) return rates[2]; if (fyc < 10000) return rates[3];
        if (fyc < 20000) return rates[4]; if (fyc < 30000) return rates[5];
        if (fyc < 60000) return rates[6]; return rates[7];
    }

    function getSubsidy(fyc, tag, period) {
        let t=0, d=0;
        if(tag==='ä¼˜++') {
            let idx = [3000,6000,10000,20000,30000,60000].findIndex(v => fyc<v);
            if(idx===-1) idx=5; else idx=Math.max(0,idx-1);
            if(fyc>=3000){ t=(period==='13-18')?[1800,5400,8000,16000,20000,30000][idx]:[3600,6000,10000,20000,30000,60000][idx]; d=(fyc>=10000)?[0,0,0.3,0.4,0.5,0.6][idx]:0; }
        } else {
            let idx = [600,1500,3000,6000,10000,20000,30000].findIndex(v => fyc<v);
            if(idx===-1) idx=6; else idx=Math.max(0,idx-1);
            if(period==='1-3') t=tag==='ä¼˜+'?[1000,2400,3600,4400,5400,8500,11500][idx]:(tag==='FNA'?[1000,1800,2400,3000,3800,6000,8000][idx]:[600,1100,1400,1400,1400,1400,1400][idx]);
            else if(period==='4-12'&&tag!=='NA') t=tag==='ä¼˜+'?[1000,1600,2700,4400,5400,8500,11500][idx]:[1000,1300,1800,2400,3300,5500,7500][idx];
            else if(period==='13-18'&&tag==='ä¼˜+') t=[0,0,1400,2700,3600,5800,8100][idx];
        }
        return { cash: t*(1-d), defer: t*d };
    }

    // âœ… ä¿®æ­£åçš„å¢å‘˜å¥–è®¡ç®—å‡½æ•°
    function calculateReferralBonus(referralFyc, months, continuation = '80%ä»¥ä¸Š') {
        let c1 = 0;

        // --- C1 è®¡ç®— ---
        if (months === '1-12') {
            if (referralFyc < 1500) c1 = 0.05;
            else if (referralFyc < 3000) c1 = 0.15;
            else if (referralFyc < 6000) c1 = 0.21;
            else c1 = 0.24; // >=6000
        } else if (months === '13-24') {
            if (referralFyc >= 3000 && referralFyc < 6000) c1 = 0.08;
            else if (referralFyc >= 6000) c1 = 0.10;
            else c1 = 0; // <3000 æ— å¥–åŠ±
        }

        // --- C2 è®¡ç®—ï¼šä»… 13-24 æœˆå—ç»§ç»­ç‡å½±å“ ---
        let c2 = 1; // é»˜è®¤ 100%
        if (months === '13-24') {
            c2 = (continuation === '80%ä»¥ä¸Š') ? 1 : 0;
        }
        // 1-12 æœˆï¼šc2 æ’ä¸º 1

        const bonus = referralFyc * c1 * c2;
        return { c1: c1 * 100, c2: c2 * 100, total: bonus };
    }

    function updateReferralInputs() {
        const hasReferral = document.getElementById('hasReferral').value === 'æ˜¯';
        const inputs = document.getElementById('referralInputs');
        inputs.style.display = hasReferral ? 'flex' : 'none';
    }

    let schemes = [];
    let sIdx = 1;

    function addScheme() {
        const f = parseFloat(document.getElementById('fyc').value) || 0;
        const r = document.getElementById('rank').value;
        const t = document.getElementById('tag').value;
        const p = document.getElementById('period').value;
        const rate = getSalesRate(f, r);
        const sales = f * rate;
        const sub = getSubsidy(f, t, p);

        let refTotal = 0;
        let hasReferral = false;

        if (document.getElementById('hasReferral').value === 'æ˜¯') {
            hasReferral = true;
            const months = document.getElementById('referralMonths').value;
            const inputVal = document.getElementById('referralFycInput').value.trim();
            if (!inputVal) {
                alert("è¯·è¾“å…¥è¢«æ¨èæ–°äººçš„å½“æœˆFYCï¼");
                return;
            }
            const referralFyc = parseFloat(inputVal);
            if (isNaN(referralFyc) || referralFyc < 0) {
                alert("è¢«æ¨èæ–°äººFYCå¿…é¡»æ˜¯éè´Ÿæ•°å­—ï¼");
                return;
            }

            const continuation = document.getElementById('referralContinuation').value;
            const refBonus = calculateReferralBonus(referralFyc, months, continuation);
            refTotal = refBonus.total;
        }

        const total = f + sales + sub.cash + sub.defer + refTotal;
        const id = 's' + Date.now();

        schemes.push({
            id, total, fyc: f, sales, subsidy: sub.cash, defer: sub.defer,
            ref_total: refTotal,
            hasReferral
        });

        // æ·»åŠ è¡¨å¤´
        const th = document.createElement('th');
        th.id = id + '-h';
        th.innerHTML = `æ–¹æ¡ˆ ${sIdx}<br><small>${t}(${p})</small><span class="del-btn" onclick="removeCol('${id}')">ç§»é™¤</span>`;
        document.getElementById('hRow').appendChild(th);

        // ä¸»æ•°æ®å¯¹è±¡
        const m = {
            rank: r,
            tag: `${t}(${p})æœŸ`,
            fyc: `Â¥${f.toLocaleString()}`,
            sales: `Â¥${sales.toLocaleString()} (${(rate*100).toFixed(0)}%)`,
            subsidy: `Â¥${sub.cash.toLocaleString()}`,
            defer: `Â¥${sub.defer.toLocaleString()}`,
            ref_total: hasReferral ? `Â¥${refTotal.toLocaleString()}` : 'â€”',
            total: `<div class="crown-icon">ğŸ‘‘</div><span class="total-val">Â¥${total.toLocaleString()}</span>`
        };

        // å¡«å……ä¸»è¡¨
        Array.from(document.getElementById('bBody').rows).forEach(row => {
            const k = row.getAttribute('data-k');
            if (k) {
                const td = document.createElement('td');
                td.className = id + '-c' + (k === 'total' ? ' win-cell' : '');
                td.innerHTML = m[k];
                row.appendChild(td);
            } else if (row.classList.contains('cat-row')) {
                const td = document.createElement('td');
                td.className = id + '-c';
                row.appendChild(td);
            }
        });

        updateWin();
        sIdx++;
    }

    function removeCol(id) {
        document.getElementById(id+'-h').remove();
        document.querySelectorAll('.'+id+'-c').forEach(c => c.remove());
        schemes = schemes.filter(x => x.id !== id);
        updateWin();
    }

    function updateWin() {
        if(!schemes.length) return;
        const max = Math.max(...schemes.map(s => s.total));
        schemes.forEach(s => {
            const el = document.querySelector('.' + s.id + '-c.win-cell');
            if (el) {
                if (s.total === max && max > 0) el.classList.add('is-winner');
                else el.classList.remove('is-winner');
            }
        });
    }

    function smartPrint() {
        const table = document.getElementById('resTable');
        const A4_W = 1080;
        let originalZoom = document.body.style.zoom || '';
        if(table.offsetWidth > A4_W) {
            document.body.style.zoom = (A4_W / table.offsetWidth).toFixed(2);
        }
        window.print();
        setTimeout(() => document.body.style.zoom = originalZoom, 500);
    }

    function exportExcel() {
        const tableClone = document.getElementById('resTable').cloneNode(true);
        tableClone.querySelectorAll('.del-btn, .crown-icon').forEach(el => el.remove());
        tableClone.querySelectorAll('td, th').forEach(cell => {
            let txt = cell.textContent.trim();
            if (txt.includes('Â¥')) {
                cell.textContent = txt.replace(/[Â¥,]/g, '');
            }
            if (cell.classList.contains('win-cell') && cell.querySelector('.total-val')) {
                const totalVal = cell.querySelector('.total-val').textContent.replace(/[Â¥,]/g, '');
                cell.textContent = `${totalVal} (æœ€ä¼˜)`;
            }
        });

        const wb = XLSX.utils.table_to_book(tableClone, { sheet: "æ–°äººæ”¶å…¥æµ‹ç®—" });
        XLSX.writeFile(wb, 'æ–°äººåˆ©ç›Šæµ‹ç®—çœ‹æ¿.xlsx');
    }

    window.onload = () => {
        initPeriodOptions();
        updateReferralInputs();
        
        const c = document.createElement('canvas'); 
        c.width = 400; 
        c.height = 300;
        const ctx = c.getContext('2d'); 
        ctx.rotate(-0.4); 
        ctx.font = 'bold 24px Arial';
        ctx.fillStyle = 'rgba(0,0,0,0.1)';
        ctx.fillText('PAç¦å°æ˜Š Â© 2026', 40, 160);
        document.getElementById('watermark').style.backgroundImage = `url(${c.toDataURL()})`;
    }
</script>
</body>
</html>