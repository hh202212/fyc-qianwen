<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°äººæ”¶å…¥ç›®æ ‡æµ‹ç®—çœ‹æ¿</title>
    <script src="https://fastly.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #e60012; --gray: #f4f4f4; --border: #ddd; --gold: #d4a017; --tip-bg: #fffbe6; --secondary: #1890ff; --danger: #ff4d4f; }
        body { font-family: "PingFang SC", "Microsoft YaHei"; background: #fafafa; margin: 0; padding: 12px; }
        * { box-sizing: border-box; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }

        .container { max-width: 1400px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 15px rgba(0,0,0,0.1); position: relative; overflow: hidden; }
        .watermark-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; opacity: 0.15; background-repeat: repeat; }

        .header-area { border-bottom: 2px solid var(--primary); margin-bottom: 10px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: flex-end; position: relative; z-index: 20; flex-wrap: wrap; gap: 10px; }
        .main-title { font-size: 22px; font-weight: bold; color: #333; margin: 0; }

        .top-nav-container { margin-bottom: 16px; display: flex; flex-wrap: wrap; gap: 8px; position: relative; z-index: 20; }
        .btn-link { color: #856404; background: var(--tip-bg); border: 1px solid #ffe58f; padding: 7px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center; transition: 0.2s; }
        
        .rule-body { display: none; background: var(--tip-bg); border: 1px solid #ffe58f; border-top: none; padding: 18px; border-radius: 0 0 4px 4px; margin-top: -8px; margin-bottom: 18px; position: relative; z-index: 19; }
        .rule-columns { display: flex; gap: 30px; flex-wrap: wrap; }
        .rule-col { flex: 1; min-width: 320px; font-size: 13px; color: #856404; line-height: 1.8; }
        .rule-title-sm { font-weight: bold; font-size: 14px; margin-bottom: 8px; color: #5d4603; border-bottom: 1px dashed #ffe58f; padding-bottom: 4px; }
        .indent-1 { padding-left: 15px; }
        .indent-2 { padding-left: 30px; }

        /* è¾“å…¥é¢æ¿å¸ƒå±€ */
        .input-panel { display: flex; flex-wrap: wrap; gap: 12px; background: var(--gray); padding: 18px; border-radius: 6px; margin-bottom: 24px; position: relative; z-index: 20; align-items: flex-end; }
        .input-group { display: flex; flex-direction: column; gap: 6px; flex: 1; min-width: 140px; }
        .input-group label { font-size: 13px; font-weight: bold; color: #444; white-space: nowrap; }
        input, select { height: 38px; padding: 0 8px; border: 1px solid var(--border); border-radius: 4px; background: #fff; font-size: 13px; width: 100%; outline: none; }

        /* å¢å‘˜é¡¹å¯¹é½ä¼˜åŒ– */
        #referralInputs { width: 100%; display: none; gap: 12px; margin-top: 5px; }
        .ref-item { flex: 1; min-width: 150px; display: flex; flex-direction: column; gap: 6px; }
        .ref-item label { font-size: 13px; font-weight: bold; color: #444; } /* ç¡®ä¿æ–‡å­—å¤§å°ä¸€è‡´ */

        /* ç¦åˆ©è®°å¿†åº“ */
        .history-tags { width: 100%; display: flex; flex-wrap: wrap; gap: 6px; margin-top: 5px; }
        .history-tag { background: #f0f0f0; border: 1px solid #ccc; padding: 2px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; color: #666; }
        .history-tag:hover { background: #e0e0e0; color: var(--primary); }

        .custom-items-wrapper { width: 100%; display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .custom-item-tag { background: #e6f7ff; border: 1px solid #91d5ff; color: #1890ff; padding: 4px 10px; border-radius: 4px; font-size: 12px; display: flex; align-items: center; gap: 6px; }

        .btn-calc { background: var(--primary); color: #fff; border: none; padding: 0 20px; border-radius: 4px; cursor: pointer; font-weight: bold; height: 38px; transition: 0.3s; }
        .btn-add-custom { background: var(--secondary); color: #fff; border: none; padding: 0 12px; border-radius: 4px; cursor: pointer; height: 38px; font-size: 12px; }

        .table-wrapper { overflow-x: auto; border: 1px solid var(--border); border-radius: 4px; position: relative; z-index: 15; background: #fff; margin-bottom: 10px; }
        .compare-table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 1000px; }
        .compare-table th, .compare-table td { border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 10px 8px; text-align: center; font-size: 13px; white-space: nowrap; }
        .label-col { width: 170px; min-width: 170px !important; background: #f9f9f9 !important; text-align: left !important; font-weight: bold; position: sticky; left: 0; z-index: 5; box-shadow: 2px 0 5px rgba(0,0,0,0.05); }
        .header-row th { background: #fff; position: sticky; top: 0; z-index: 6; color: var(--primary); border-bottom: 2px solid var(--primary); }
        .cat-row { background: #fff1f0 !important; font-weight: bold; color: var(--primary); }
        
        .total-val { font-size: 17px; font-weight: 800; color: var(--primary); }
        .is-winner .total-val { color: var(--gold); }
        .crown-icon { display: none; font-size: 18px; margin-bottom: 2px; }
        .is-winner .crown-icon { display: block; }
        .del-btn { display: block; margin-top: 4px; font-size: 11px; color: #999; cursor: pointer; border: 1px solid #ddd; padding: 1px 6px; border-radius: 10px; width: fit-content; margin: 4px auto 0 auto; }

        @media print {
            @page { size: A4 landscape; margin: 0.3cm; }
            .input-panel, .del-btn, .action-btns button:not(.print-keep), .rule-btn, .top-nav-container a, .btn-add-custom, .custom-items-wrapper { display: none !important; }
            .rule-body.print-active { display: block !important; border: 1px solid #ffe58f; margin-bottom: 10px; padding: 6px; font-size: 10px !important; }
            .compare-table { width: 100% !important; min-width: 0 !important; }
            .compare-table th, .compare-table td { padding: 3px 1px !important; font-size: 10px !important; }
            .label-col { position: static !important; width: 130px !important; min-width: 130px !important; }
        }
    </style>
</head>
<body>

<div class="container" id="mainContainer">
    <div class="watermark-overlay" id="watermark"></div>

    <div class="header-area">
        <div><p class="main-title">æ–°äººæ”¶å…¥ç›®æ ‡æµ‹ç®—çœ‹æ¿</p><p class="sub-title">ç‰ˆæƒå½’PAç¦å°æ˜Š - 2026ç‰ˆåŸºæœ¬æ³• (é«˜ç²¾æµ‹ç®—ç‰ˆ)</p></div>
        <div class="action-btns">
            <button class="btn-calc" style="background:var(--danger); height:34px; font-size:12px;" onclick="clearAllData()">æ¸…ç©ºè®°å½•</button>
            <button class="btn-calc" style="background:#52c41a; height:34px; font-size:12px;" onclick="exportExcel()">å¯¼å‡º Excel</button>
            <button class="btn-calc" style="background:var(--secondary); height:34px; font-size:12px; margin-left:5px;" onclick="smartPrint()">æ‰“å° A4</button>
        </div>
    </div>

    <div class="top-nav-container">
        <div class="btn-link rule-btn" onclick="toggleRule()">è®­ç»ƒæ´¥è´´å‘æ”¾æ¡ä»¶ [ç‚¹å‡»å±•å¼€åŸæ–‡]</div>
        <a href="https://free-img.400040.xyz/4/2026/02/01/697f049d026fe.jpg" target="_blank" class="btn-link">é¦–æ¬¡é’»æ–¹æ¡ˆ â†—</a>
        <a href="https://free-img.400040.xyz/4/2026/02/01/697f049ece8ab.jpg" target="_blank" class="btn-link">æ–°äººä¸€æ¡Œå®´æ–¹æ¡ˆ â†—</a>
    </div>

    <div class="rule-body" id="ruleBody">
        <div class="rule-columns">
            <div class="rule-col">
                <div class="rule-title-sm">ç¬¬ 1-12 æœŸè®­ç»ƒæ´¥è´´å‘æ”¾æ¡ä»¶</div>
                <div>ï¼ˆä¸€ï¼‰æ–°äººä¼˜++ã€ä¼˜+ã€FNA è®­ç»ƒæ´¥è´´å‘æ”¾æ¡ä»¶ï¼š</div>
                <div class="indent-1">1ï¼å½“æœˆå‚ä¼šç‡â‰¥75%ï¼›</div>
                <div class="indent-1">2ï¼æˆªè‡³å½“æœˆå·²å®Œæˆç›¸å…³åŸ¹è®­å¹¶è¾¾æ ‡ï¼š</div>
                <div class="indent-2">ï¼ˆ1ï¼‰å½“æœˆé£é¹°åŸ¹è®­åˆæ ¼ï¼ˆå…¥å¸ç¬¬ 2 æœˆè€ƒå¯Ÿï¼‰ï¼›</div>
                <div class="indent-2">ï¼ˆ2ï¼‰å½“æœˆæ–°é”åŸ¹è®­åˆæ ¼ï¼ˆå…¥å¸ç¬¬ 4 æœˆè€ƒå¯Ÿï¼‰ï¼›</div>
                <div class="indent-2">ï¼ˆ3ï¼‰å½“æœˆæ–°äººé›†è®­åŸ¹è®­åˆæ ¼ï¼ˆå…¥å¸ç¬¬ 5-12 æœˆè€ƒå¯Ÿï¼Œä»…é™ä¼˜+ã€ä¼˜++ï¼‰ã€‚</div>
                <div class="indent-1">3ï¼æˆªè‡³å½“æœˆå·²è½¬æ­£ï¼ˆè‡ªå…¥å¸ç¬¬ 4 æœˆèµ·è€ƒå¯Ÿï¼‰</div>
            </div>
            <div class="rule-col">
                <div class="rule-title-sm">ç¬¬ 13-18 æœŸè®­ç»ƒæ´¥è´´å‘æ”¾æ¡ä»¶</div>
                <div>ï¼ˆä¸€ï¼‰å½“æœˆå‚ä¼šç‡â‰¥75%ï¼›</div>
                <div>ï¼ˆäºŒï¼‰æ–°å¥‘çº¦åœ¨èŒå•ç¬¬ 13 æœˆä¿è´¹ç»§ç»­ç‡â‰¥80%ã€‚</div>
            </div>
        </div>
    </div>

    <div class="input-panel">
        <div class="input-group"><label>äººå‘˜èŒçº§</label><select id="rank"><option value="P0">P0</option><option value="P1">P1</option><option value="P2">P2</option><option value="P3">P3</option><option value="P4">P4</option><option value="P5">P5</option><option value="P6">P6</option><option value="P7">P7</option><option value="P8">P8</option><option value="P9">P9</option></select></div>
        <div class="input-group"><label>äººå‘˜æ ‡ç­¾</label><select id="tag" onchange="initPeriodOptions()"><option value="ä¼˜++">ä¼˜++æ–°äºº</option><option value="ä¼˜+" selected>ä¼˜+æ–°äºº</option><option value="FNA">FNAæ–°äºº</option><option value="NA">NAæ–°äºº</option></select></div>
        <div class="input-group"><label>è®­æ´¥æœŸæ•°</label><select id="period"></select></div>
        <div class="input-group"><label>ä¸ªäººæœˆFYC</label><input type="number" id="fyc" value="3000"></div>
        <div class="input-group"><label>æ˜¯å¦æœ‰å¢å‘˜ï¼Ÿ</label><select id="hasReferral" onchange="updateReferralInputs()"><option value="å¦">å¦</option><option value="æ˜¯">æ˜¯</option></select></div>
        
        <div id="referralInputs">
            <div class="ref-item"><label>æ¨èæ–°äººå…¥å¸æœˆæ•°</label><select id="referralMonths"><option value="1-12">1-12 æœˆ</option><option value="13-24">13-24 æœˆ</option></select></div>
            <div class="ref-item"><label>æ¨èæ–°äººå½“æœˆFYC</label><input type="number" id="referralFycInput" value="3000"></div>
            <div class="ref-item"><label>ç¬¬13ä¸ªæœˆç»§ç»­ç‡</label><select id="referralContinuation"><option value="80%ä»¥ä¸‹">80%ä»¥ä¸‹</option><option value="80%ä»¥ä¸Š" selected>80%åŠä»¥ä¸Š</option></select></div>
        </div>
        
        <div style="width: 100%; border-top: 1px solid #eee; margin: 8px 0; padding-top: 12px; display: flex; flex-direction: column; gap: 8px;">
            <div style="display: flex; gap: 12px; align-items: flex-end;">
                <div class="input-group" style="flex: 2;"><label>æ‰‹åŠ¨æ·»åŠ ç¦åˆ©é¡¹ç›® (ä»·å€¼åˆ—å…¥æ€»è®¡)</label><input type="text" id="customName" placeholder="é¡¹ç›®åç§°"></div>
                <div class="input-group" style="flex: 1;"><label>ä»·å€¼ (å…ƒ)</label><input type="number" id="customAmount" placeholder="0"></div>
                <button class="btn-add-custom" onclick="addCustomItem()">ï¼‹ æš‚å­˜è¯¥ç¦åˆ©</button>
            </div>
            <div class="history-tags" id="historyTags"></div>
        </div>
        <div class="custom-items-wrapper" id="customItemsList"></div>
        <button class="btn-calc" style="width: 100%; margin-top: 8px;" onclick="addScheme()">ç”Ÿæˆå¹¶åŠ å…¥å¯¹æ¯”æ–¹æ¡ˆ</button>
    </div>

    <div class="table-wrapper">
        <table class="compare-table" id="resTable">
            <thead><tr class="header-row" id="hRow"><th class="label-col">æµ‹ç®—å¯¹æ¯”ç»´åº¦</th></tr></thead>
            <tbody id="bBody">
                <tr class="cat-row"><td class="label-col">äººå‘˜ä¿¡æ¯</td></tr>
                <tr data-k="rank"><td class="label-col">æµ‹ç®—èŒçº§</td></tr>
                <tr data-k="tag"><td class="label-col">æ ‡ç­¾/æœŸæ•°</td></tr>
                <tr class="cat-row"><td class="label-col">ç›´æ¥æ”¶ç›Šé¡¹ç›®</td></tr>
                <tr data-k="fyc"><td class="label-col">ä½£é‡‘ (FYC)</td></tr>
                <tr data-k="sales"><td class="label-col">é”€å”®æ´¥è´´ (ç³»æ•°C)</td></tr>
                <tr data-k="subsidy"><td class="label-col">è®­ç»ƒæ´¥è´´ (å®å‘)</td></tr>
                <tr data-k="defer"><td class="label-col">è®­ç»ƒæ´¥è´´é€’å»¶</td></tr>
                <tr data-k="ref_total"><td class="label-col">å¢å‘˜å¥–</td></tr>
                <tr class="cat-row"><td class="label-col">å…¶ä»–ç¦åˆ©é¡¹</td></tr>
                <tr class="total-row" data-k="total" style="background:#fff9f9"><td class="label-col">é¢„è®¡æ€»åˆ©ç›Š</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    let currentCustomItems = [];
    let schemes = [];
    let sIdx = 1;
    let welfareHistory = [];

    function saveData() { 
        localStorage.setItem('fyc_v7', JSON.stringify(schemes)); 
        localStorage.setItem('fyc_idx_v7', sIdx); 
        localStorage.setItem('fyc_wHistory_v7', JSON.stringify(welfareHistory));
    }
    function loadData() {
        const saved = localStorage.getItem('fyc_v7'), sHist = localStorage.getItem('fyc_wHistory_v7');
        if (saved) { schemes = JSON.parse(saved); sIdx = parseInt(localStorage.getItem('fyc_idx_v7')) || 1; rebuildTable(); }
        if (sHist) { welfareHistory = JSON.parse(sHist); renderHistoryTags(); }
    }
    function clearAllData() { if(confirm("ç¡®å®šå½»åº•æ¸…ç©ºæ‰€æœ‰è®°å½•å—ï¼Ÿ")) { localStorage.clear(); location.reload(); } }

    function rebuildTable() {
        const hRow = document.getElementById('hRow'), bBody = document.getElementById('bBody');
        while (hRow.cells.length > 1) hRow.deleteCell(1);
        Array.from(bBody.rows).forEach(row => { while (row.cells.length > 1) row.deleteCell(1); });
        Array.from(bBody.querySelectorAll('tr[data-custom-row]')).forEach(r => r.remove());

        const allNames = [...new Set(schemes.flatMap(s => s.customItems.map(i => i.name)))];
        const otherCat = Array.from(bBody.rows).find(r => r.innerText.includes('å…¶ä»–ç¦åˆ©é¡¹'));
        allNames.forEach(name => {
            const tr = document.createElement('tr'); tr.setAttribute('data-custom-row', name);
            tr.innerHTML = `<td class="label-col">${name}</td>`; otherCat.after(tr);
        });

        schemes.forEach(s => {
            const th = document.createElement('th'); th.id = s.id + '-h';
            th.innerHTML = `æ–¹æ¡ˆ ${s.displayIdx}<br><span class="del-btn" onclick="removeCol('${s.id}')">ç§»é™¤</span>`;
            hRow.appendChild(th);
            Array.from(bBody.rows).forEach(row => {
                const k = row.getAttribute('data-k'), cName = row.getAttribute('data-custom-row'), td = document.createElement('td');
                td.className = s.id + '-c' + (k==='total'?' win-cell':'');
                if(k) td.innerHTML = s.dataMap[k] || 'â€”';
                else if(cName) { const match = s.customItems.find(i => i.name === cName); td.innerHTML = match ? `Â¥${match.amount.toLocaleString()}` : 'â€”'; }
                row.appendChild(td);
            });
        });
        updateWin();
    }

    function addCustomItem() {
        const name = document.getElementById('customName').value.trim();
        const amount = parseFloat(document.getElementById('customAmount').value);
        if (name && !isNaN(amount)) {
            currentCustomItems.push({ name, amount });
            if (!welfareHistory.includes(name)) welfareHistory.push(name);
            renderCustomTags(); renderHistoryTags();
            document.getElementById('customName').value = ''; document.getElementById('customAmount').value = '';
        }
    }

    function renderCustomTags() {
        document.getElementById('customItemsList').innerHTML = currentCustomItems.map((item, index) => `
            <div class="custom-item-tag">${item.name}: Â¥${item.amount}<span onclick="currentCustomItems.splice(${index},1);renderCustomTags();" style="cursor:pointer;color:red;margin-left:5px;">Ã—</span></div>
        `).join('');
    }

    function renderHistoryTags() {
        document.getElementById('historyTags').innerHTML = welfareHistory.map(name => `
            <div class="history-tag" onclick="document.getElementById('customName').value='${name}'">${name}</div>
        `).join('');
    }

    const salesMatrix = { 'P0':[0,0,0,0,0,0,0,0],'P1':[0,0,0,0,0,0,0,0],'P2':[0,0.04,0.09,0.13,0.13,0.13,0.13,0.13],'P3':[0,0.06,0.11,0.15,0.18,0.18,0.18,0.18],'P4':[0,0.06,0.25,0.30,0.35,0.35,0.35,0.35],'P5':[0,0.06,0.27,0.32,0.37,0.42,0.42,0.42],'P6':[0,0.06,0.30,0.34,0.40,0.45,0.47,0.47],'P7':[0,0.06,0.32,0.37,0.42,0.50,0.52,0.55],'P8':[0,0.06,0.32,0.37,0.45,0.52,0.55,0.57],'P9':[0,0.06,0.32,0.37,0.45,0.55,0.57,0.60] };
    function getSubsidy(fyc, tag, period) { let val=0, def=0; if(tag==='ä¼˜++') { let i=[3000,6000,10000,20000,30000,60000].findIndex(v=>fyc<v); i=i===-1?5:Math.max(0,i-1); if(fyc>=3000){ val=(period==='13-18')?[1800,5400,8000,16000,20000,30000][i]:[3600,6000,10000,20000,30000,60000][i]; def=f>=10000?[0,0,0.3,0.4,0.5,0.6][i]:0; } } else { let i=[600,1500,3000,6000,10000,20000,30000].findIndex(v=>fyc<v); i=i===-1?6:Math.max(0,i-1); if(period==='1-3') val=tag==='ä¼˜+'?[1000,2400,3600,4400,5400,8500,11500][i]:(tag==='FNA'?[1000,1800,2400,3000,3800,6000,8000][i]:[600,1100,1400,1400,1400,1400,1400][i]); else if(period==='4-12'&&tag!=='NA') val=tag==='ä¼˜+'?[1000,1600,2700,4400,5400,8500,11500][i]:[1000,1300,1800,2400,3300,5500,7500][i]; else if(period==='13-18'&&tag==='ä¼˜+') val=[0,0,1400,2700,3600,5800,8100][i]; } return { cash: val*(1-def), defer: val*def }; }

    function addScheme() {
        const f = parseFloat(document.getElementById('fyc').value)||0, r = document.getElementById('rank').value, t = document.getElementById('tag').value, p = document.getElementById('period').value;
        const rates = salesMatrix[r]||salesMatrix['P0'], rate = f<1500?rates[0]:f<3000?rates[1]:f<6000?rates[2]:f<10000?rates[3]:f<20000?rates[4]:f<30000?rates[5]:f<60000?rates[6]:rates[7];
        const sales = f * rate, sub = getSubsidy(f, t, p);
        let ref = 0; if(document.getElementById('hasReferral').value==='æ˜¯'){ 
            const rf=parseFloat(document.getElementById('referralFycInput').value)||0, rm=document.getElementById('referralMonths').value, rc=document.getElementById('referralContinuation').value;
            const c1=(rm==='1-12')?(rf<1500?0.05:rf<3000?0.15:rf<6000?0.21:0.24):(rf>=6000?0.1:rf>=3000?0.08:0);
            ref=rf*c1*((rm==='13-24'&&rc==='80%ä»¥ä¸‹')?0:1);
        }
        const total = f+sales+sub.cash+sub.defer+ref+currentCustomItems.reduce((s,i)=>s+i.amount, 0);
        const dataMap = { rank:r, tag:`${t}(${p})æœŸ`, fyc:`Â¥${f.toLocaleString()}`, sales:`Â¥${sales.toLocaleString()} (${(rate*100).toFixed(0)}%)`, subsidy:`Â¥${sub.cash.toLocaleString()}`, defer:`Â¥${sub.defer.toLocaleString()}`, ref_total:`Â¥${ref.toLocaleString()}`, total:`<div class="crown-icon">ğŸ‘‘</div><span class="total-val">Â¥${total.toLocaleString()}</span>` };
        schemes.push({ id:'s'+Date.now(), total, displayIdx: sIdx++, customItems: [...currentCustomItems], dataMap });
        saveData(); rebuildTable(); currentCustomItems = []; renderCustomTags();
    }

    function removeCol(id) { schemes = schemes.filter(x => x.id !== id); saveData(); rebuildTable(); }
    function updateWin() {
        if(!schemes.length) return;
        const max = Math.max(...schemes.map(s => s.total));
        schemes.forEach(s => { const el = document.querySelector('.' + s.id + '-c.win-cell'); if (el) el.classList.toggle('is-winner', s.total === max && max > 0); });
    }

    function toggleRule() { const b = document.getElementById('ruleBody'); b.style.display = (b.style.display==='block'?'none':'block'); b.classList.toggle('print-active'); }
    function initPeriodOptions() { const t = document.getElementById('tag').value, p = document.getElementById('period'); p.innerHTML = ''; let opts = t==='ä¼˜++' ? [['4-12æœŸ','4-12'],['13-18æœŸ','13-18']] : [['1-3æœŸ','1-3'],['4-12æœŸ','4-12'],['13-18æœŸ','13-18']]; opts.forEach(o => p.add(new Option(o[0], o[1]))); }
    function updateReferralInputs() { document.getElementById('referralInputs').style.display = (document.getElementById('hasReferral').value==='æ˜¯'?'flex':'none'); }
    function smartPrint() { const t = document.getElementById('resTable'); const A4 = 1080; if(t.offsetWidth > A4) document.body.style.zoom = (A4 / t.offsetWidth).toFixed(2); window.print(); setTimeout(()=>document.body.style.zoom=1,500); }
    function exportExcel() { const t = document.getElementById('resTable').cloneNode(true); t.querySelectorAll('.del-btn, .crown-icon').forEach(e => e.remove()); XLSX.writeFile(XLSX.utils.table_to_book(t), 'æ–°äººæµ‹ç®—æŠ¥å‘Š.xlsx'); }
    window.onload = () => { initPeriodOptions(); loadData(); const c = document.createElement('canvas'); c.width=400; c.height=300; const ctx = c.getContext('2d'); ctx.rotate(-0.4); ctx.font='bold 22px Arial'; ctx.fillStyle='rgba(0,0,0,0.12)'; ctx.fillText('ç‰ˆæƒå½’PAç¦å°æ˜Š', 50, 150); document.getElementById('watermark').style.backgroundImage = `url(${c.toDataURL()})`; }
</script>
</body>
</html>
