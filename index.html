<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>新人收入目标测算看板</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        :root { 
            --primary: #e60012; 
            --gray: #f4f4f4; 
            --border: #ddd; 
            --gold: #d4a017; 
            --tip-bg: #fffbe6; 
            --text-sm: 12px;
            --text-md: 13px;
            --text-lg: 14px;
        }
        body { 
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif; 
            background: #fafafa; 
            margin: 0; 
            padding: 12px; 
            overflow-x: hidden;
            color: #333;
            position: relative;
        }
        * { box-sizing: border-box; }

        .container { 
            max-width: 100%; 
            margin: 0 auto; 
            background: #fff; 
            padding: 12px; 
            border-radius: 8px; 
            box-shadow: 0 2px 15px rgba(0,0,0,0.1); 
            position: relative; 
            overflow: hidden;
            z-index: 2; /* 确保内容在水印之上 */
        }

        /* ✅ 全新 CSS 水印实现 */
        .watermark {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 1; /* 在内容之下 */
            opacity: 1;
            background-size: 300px 300px;
            background-repeat: repeat;
            background-position: 0 0;
            /* 使用 CSS 渐变模拟文字水印（兼容性最强） */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cg transform='rotate(-30,150,150)' fill='rgba(60,60,60,0.25)' font-family='PingFang SC, Microsoft YaHei, sans-serif' font-size='24' font-weight='bold'%3E%3Ctext x='150' y='160' text-anchor='middle'%3EPA福小昊 © 2026%3C/text%3E%3C/g%3E%3C/svg%3E");
        }

        /* 其余样式保持不变 */
        .header-area { 
            border-bottom: 2px solid var(--primary); 
            margin-bottom: 12px; 
            padding-bottom: 10px; 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-end; 
            position: relative; 
            z-index: 20; 
            flex-wrap: wrap; 
            gap: 8px; 
        }
        .main-title { font-size: 18px; font-weight: bold; color: #333; margin: 0; }
        .sub-title { font-size: 10px; color: #999; }

        .top-nav-container { 
            margin-bottom: 16px; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 8px; 
            position: relative; 
            z-index: 20; 
        }
        .btn-link { 
            color: #856404; 
            background: var(--tip-bg); 
            border: 1px solid #ffe58f; 
            padding: 6px 10px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 11px; 
            font-weight: bold; 
            text-decoration: none; 
            display: inline-flex; 
            align-items: center; 
            transition: 0.2s; 
            white-space: nowrap;
        }
        .btn-link:hover { 
            background: #fff1b8; 
            border-color: #ffd666; 
            transform: translateY(-1px); 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
        }
        .rule-btn::after { content: ' ▼'; font-size: 10px; margin-left: 4px; }
        .rule-btn.active::after { content: ' ▲'; }
        
        .rule-body { 
            display: none; 
            background: var(--tip-bg); 
            border: 1px solid #ffe58f; 
            border-top: none; 
            padding: 12px; 
            border-radius: 0 0 4px 4px; 
            margin-top: -8px; 
            margin-bottom: 16px; 
            position: relative; 
            z-index: 19; 
            font-size: 11px; 
            line-height: 1.6;
        }
        .rule-columns { 
            display: flex; 
            gap: 16px; 
            flex-wrap: wrap; 
        }
        .rule-col { 
            flex: 1; 
            min-width: 220px; 
            color: #856404; 
        }

        .input-panel { 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
            background: var(--gray); 
            padding: 16px; 
            border-radius: 6px; 
            margin-bottom: 16px; 
            position: relative; 
            z-index: 20; 
        }
        @media (max-width: 768px) {
            .input-panel { padding: 12px; }
        }
        .input-group { 
            display: flex; 
            flex-direction: column; 
            gap: 6px; 
            flex: 1; 
        }
        .input-group label { 
            font-size: var(--text-sm); 
            font-weight: bold; 
            color: #444; 
        }
        input, select { 
            height: 36px; 
            padding: 0 10px; 
            border: 1px solid var(--border); 
            border-radius: 4px; 
            background: #fff; 
            font-size: var(--text-sm); 
            width: 100%; 
            outline: none; 
        }

        .btn-calc { 
            background: var(--primary); 
            color: #fff; 
            border: none; 
            padding: 10px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: var(--text-sm); 
            transition: 0.3s; 
            white-space: nowrap;
            margin-top: 8px;
        }
        .btn-calc:hover { background: #c0000f; }

        .btn-action { 
            color: #fff; 
            border: none; 
            padding: 8px 14px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: var(--text-sm); 
            white-space: nowrap;
        }

        .table-wrapper { 
            overflow-x: auto; 
            -webkit-overflow-scrolling: touch;
            border: 1px solid var(--border); 
            border-radius: 4px; 
            position: relative; 
            z-index: 15; 
            background: #fff;
            margin-bottom: 12px;
            scrollbar-width: thin;
        }

        .scroll-hint {
            background: #f0f0f0;
            color: #888;
            font-size: 10px;
            padding: 4px 8px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            pointer-events: none;
            user-select: none;
        }

        .compare-table { 
            width: 100%; 
            border-collapse: separate; 
            border-spacing: 0; 
            min-width: 600px;
        }
        .compare-table th, .compare-table td { 
            border-right: 1px solid var(--border); 
            border-bottom: 1px solid var(--border); 
            padding: 8px 6px; 
            text-align: center; 
            font-size: var(--text-sm); 
            white-space: nowrap; 
            line-height: 1.3;
        }

        .label-col { 
            width: 130px; 
            min-width: 130px !important; 
            text-align: left !important; 
            font-weight: bold; 
            font-size: var(--text-sm);
            background: #f9f9f9 !important;
            position: -webkit-sticky;
            position: sticky;
            left: 0;
            z-index: 10;
            box-shadow: 2px 0 5px rgba(0,0,0,0.08);
        }

        .header-row th { 
            background: #fff; 
            color: var(--primary); 
            border-bottom: 2px solid var(--primary); 
            font-weight: bold;
            padding: 6px 6px;
        }
        .cat-row { 
            background: #fff1f0 !important; 
            font-weight: bold; 
            color: var(--primary); 
        }
        .total-val { 
            font-size: 14px; 
            font-weight: 800; 
            color: var(--primary); 
        }
        .is-winner .total-val { 
            color: var(--gold); 
        }
        .crown-icon { 
            display: none; 
            font-size: 14px; 
            margin-bottom: 2px; 
        }
        .is-winner .crown-icon { 
            display: block; 
        }
        .del-btn { 
            display: block; 
            margin-top: 4px; 
            font-size: 10px; 
            color: #999; 
            cursor: pointer; 
            border: 1px solid #ddd; 
            padding: 0 6px; 
            border-radius: 10px; 
            width: fit-content; 
            margin: 4px auto 0 auto; 
            line-height: 1.2;
        }

        #referralInputs { 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
            padding: 0; 
        }
        #referralInputs .input-group { 
            flex: 1; 
            width: 100%; 
        }

        @media print {
            @page { size: A4 landscape; margin: 0.5cm; }
            .input-panel, .del-btn, .action-btns, .rule-toggle-container, .top-nav-container .btn-link:not(.rule-btn) { display: none !important; }
            .rule-body.print-active { display: block !important; border: 1px solid #ffe58f; margin-bottom: 15px; }
            .compare-table th, .compare-table td { padding: 5px 3px !important; font-size: 10px !important; }
            .label-col { 
                position: static !important; 
                box-shadow: none !important; 
            }
            .scroll-hint { display: none !important; }
            /* 打印时也显示水印 */
            .watermark {
                opacity: 0.3 !important;
                z-index: 0 !important;
            }
        }
    </style>
</head>
<body>

    <!-- ✅ 新增：固定水印层（放在 body 最外层） -->
    <div class="watermark"></div>

    <div class="container" id="mainContainer">
        <!-- 原有内容，无需 watermar-overlay -->
        <div class="header-area">
            <div>
                <p class="main-title">新人收入目标测算看板</p>
                <p class="sub-title">版权归PA福小昊 - 2026版C版标准</p>
            </div>
            <div class="action-btns">
                <button class="btn-action" style="background:#52c41a;" onclick="exportExcel()">导出 Excel</button>
                <button class="btn-action" style="background:#1890ff;" onclick="smartPrint()">打印 A4</button>
            </div>
        </div>

        <div class="top-nav-container">
            <div class="btn-link rule-btn" id="ruleBtn" onclick="toggleRule()">训练津贴发放条件</div>
            <a href="https://free-img.400040.xyz/4/2026/02/01/697f049d026fe.jpg" target="_blank" class="btn-link">首次钻方案 ↗</a>
            <a href="https://www.pingan.cn" target="_blank" class="btn-link">新人小高峰方案 ↗</a>
            <a href="https://www.pingan.cn" target="_blank" class="btn-link">主管陪访方案 ↗</a>
            <a href="https://free-img.400040.xyz/4/2026/02/01/697f049ece8ab.jpg" target="_blank" class="btn-link">新人一桌宴方案 ↗</a>
        </div>

        <div class="rule-body" id="ruleBody">
            <div class="rule-columns">
                <div class="rule-col">
                    <strong>第 1-12 期训练津贴发放条件</strong><br>
                    1．当月参会率≥75%；<br>
                    2．培训达标：飞鹰培训(第2月)、新锐培训(第4月)、新人集训合格(第5-12月，仅优+/优++)；<br>
                    3．截至当月已转正（自入司第 4 月起考察）
                </div>
                <div class="rule-col">
                    <strong>第 13-18 期训练津贴发放条件</strong><br>
                    （一）当月参会率≥75%；<br>
                    （二）新契约在职单第 13 月保费继续率≥80%。
                </div>
            </div>
        </div>

        <div class="input-panel">
            <div class="input-group">
                <label>人员职级</label>
                <select id="rank">
                    <option value="P0" selected>P0 试用业务员</option>
                    <option value="P1">P1 业务员</option><option value="P2">P2 业务员</option>
                    <option value="P3">P3 业务员</option><option value="P4">P4 业务员</option>
                    <option value="P5">P5 业务员</option><option value="P6">P6 业务员</option>
                    <option value="P7">P7 业务员</option><option value="P8">P8 业务员</option>
                    <option value="P9">P9 业务员</option>
                </select>
            </div>
            <div class="input-group">
                <label>人员标签</label>
                <select id="tag" onchange="initPeriodOptions()">
                    <option value="优++">优++新人</option><option value="优+" selected>优+新人</option>
                    <option value="FNA">FNA新人</option><option value="NA">NA新人</option>
                </select>
            </div>
            <div class="input-group"><label>训练津贴期数</label><select id="period"></select></div>
            <div class="input-group">
                <label>个人月度FYC (元)</label>
                <input type="number" id="fyc" value="3000">
            </div>
            <div class="input-group">
                <label>是否有增员？</label>
                <select id="hasReferral" onchange="updateReferralInputs()">
                    <option value="否">否</option>
                    <option value="是">是</option>
                </select>
            </div>
            <div id="referralInputs" style="display: none;">
                <div class="input-group">
                    <label>被推荐新人入司月数</label>
                    <select id="referralMonths">
                        <option value="1-12">1-12 月</option>
                        <option value="13-24">13-24 月</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>被推荐新人当月FYC (元)</label>
                    <input type="number" id="referralFycInput" value="2999" min="0">
                </div>
                <div class="input-group">
                    <label>第13个月保费继续率</label>
                    <select id="referralContinuation">
                        <option value="80%以下">80% 以下</option>
                        <option value="80%以上" selected>80%（含）以上</option>
                    </select>
                </div>
            </div>
            <button class="btn-calc" onclick="addScheme()">加入对比方案</button>
        </div>

        <div class="scroll-hint">← 左右滑动查看全部方案 →</div>

        <div class="table-wrapper">
            <table class="compare-table" id="resTable">
                <thead><tr class="header-row" id="hRow"><th class="label-col">对比维度</th></tr></thead>
                <tbody id="bBody">
                    <tr class="cat-row"><td class="label-col">人员信息</td></tr>
                    <tr data-k="rank"><td class="label-col">测算职级</td></tr>
                    <tr data-k="tag"><td class="label-col">标签/期数</td></tr>
                    <tr class="cat-row"><td class="label-col">直接收入现金流</td></tr>
                    <tr data-k="fyc"><td class="label-col">佣金 (FYC)</td></tr>
                    <tr data-k="sales"><td class="label-col">销售津贴 (系数C)</td></tr>
                    <tr data-k="subsidy"><td class="label-col">训津 (当期实发)</td></tr>
                    <tr class="cat-row"><td class="label-col">递延记账项</td></tr>
                    <tr data-k="defer"><td class="label-col">训津递延</td></tr>
                    <tr data-k="ref_total"><td class="label-col">增员奖</td></tr>
                    <tr class="total-row" data-k="total" style="background:#fff9f9"><td class="label-col">预计总收益 (含递延与增员奖)</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // ... [保留你原有的所有 JS 函数] ...

        // ✅ 移除 window.onload 中的 Canvas 水印逻辑
        window.onload = () => {
            initPeriodOptions();
            updateReferralInputs();
            // 水印已由 CSS 实现，无需 JS
        }
    </script>
</body>
</html>
